<!DOCTYPE html>
<html lang="en">
    <title>Index</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="">
    <style>
        path {
          stroke: white;
          stroke-width: 0.25px;
          fill: grey;
        }
    </style>
    <body>
        <h1>Hi there!</h1>
        <script src="https://d3js.org/d3.v3.min.js"></script>
        <script src="https://d3js.org/topojson.v0.min.js"></script>
        <script>
            
            // Map constants:
            const width = 1600;
            const height = 1000;
            const projection = d3.geo.mercator()
                .center([0, 5 ])
                .scale(200)
                .rotate([-180,0]);
            const svg = d3.select("body").append("svg")
                .attr("width", width)
                .attr("height", height);
            const path = d3.geo.path()
                .projection(projection);
            const g = svg.append("g");

            // Draw Map
            d3.json("https://gist.githubusercontent.com/d3noob/5189284/raw/7c4bbf3f44d2aeb4d01ca6365b7978b09fdc8766/world-110m2.json",
                function(error, topology) {
                    g.selectAll("path")
                        .data(topojson.object(topology, topology.objects.countries).geometries)
                        .enter()
                        .append("path")
                        .attr("d", path)
                }
            );

            const drawCoordinates = (dataArray) =>  {
                d3.json(dataArray,
                    function(error, data) {
                        if (error) { console.log(error); }
                        console.log("Reading Data!");
                        console.log(data);
                        g.selectAll("circle")
                            .data(data)
                            .enter()
                            .append("circle")
                            .attr("cx", function(d) {
                                    return projection([d.value.Longitude, d.value.Latitude])[0];
                            })
                            .attr("cy", function(d) {
                                    return projection([d.value.Longitude, d.value.Latitude])[1];
                            })
                            .attr("r", "3px")
                            .attr("fill", function() {
                                return "hsl(" + Math.random() * 360 + ",100%,50%)";
                        });
                    }
                );
            }

            drawCoordinates("https://raw.githubusercontent.com/mactsouk/datasets/master/data.json");

            // Extra Zoom functionality
            var zoom = d3.behavior.zoom()
                .on("zoom",function() {
                    g.attr("transform","translate("+ 
                        d3.event.translate.join(",")+")scale("+d3.event.scale+")");
                    g.selectAll("circle")
                        .attr("d", path.projection(projection));
                    g.selectAll("path")  
                        .attr("d", path.projection(projection)); 
            });
            svg.call(zoom)

            const socket = new WebSocket("ws://localhost:8001");
            socket.onmessage = function(event) {
                console.log(`Received message: ${event.data}`);
                drawCoordinates("https://raw.githubusercontent.com/mactsouk/datasets/master/data.json");
            };
        </script>
    </body>
</html>
